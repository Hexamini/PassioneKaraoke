\subsection{Perl}
Il perl \`e il motore del sito, che ne permette il funzionamento offrendo pagine html all'utente, e gestisce le query sulla base XML garantendo la compatibilit\`a tra dispositivi in quando eseguito lato server.
\subsubsection{Generazione delle pagine web}
\textit{The biggest cause of unmaintainable web sites is mixing markup code such as HTML and program code such as Perl.}\footnote{[cit. \textit{Perl Template Toolkit]}\\

La netta divisione tra le tre componenti di un sito web (\textit{Presentazione}, \textit{Struttura}, \textit{Comportamento}) \`e un traguardo ambito ma non semplice da raggiungere. Se il CSS rende semplice la divisione tra struttura e presentazione, lo stesso non si pu\`o dire del Perl: contrariamente al CSS, dove si ha una netta separazione tra struttura e presentazione, \`e necessario prestare attenzione all'interazione con l'HTML. Si \`e quindi adottato uno sviluppo tramite modularizzazione, che ha permesso di raggiungere un buon traguardo.

\paragraph*{Descrizione della soluzione adottata}Una non chiara seprarazione tra struttura e comportamento sta nella mancanza di un supporto nativo per Perl ed HTML, che in grado di dare la possibilit\`a in modo \textit{semplice e bello} di definire una procedura per il popolamento di una pagina Web. L'obiettivo degli script creati durante la relizzazione del progetto \`e riempire spazi vuoti in aree \textit{statiche} costrette ad essere considerate come \textit{dinamiche} per una limitazione espressiva del linguaggio. Da qui \`e nata l'esigenza di ampliare il linguaggio HTML in modo di dare la possibilit\`a al Perl di riferirsi ad una determinata area dove inserire il contenuto d'interesse. La soluzione \`e stata raggiunta adottando l'utilizzo della libreria \textit{Perl Template Toolkit}, che rende possibile in maniera agevole l'inseriemento di \textit{segnaposti} all'interno della struttura HTML. Gli script, infine, si occuperanno di sostituire i \textit{segnaposti} con l'effettivo contenuto.
\paragraph*{Segnaposti} Qui un esempio di segnapostom, racchiuso tra la sequenza '[\%' e '\%]', applicato alla struttura HTML. 
\lstinputlisting[language=HTML,caption=Esempio di segnaposto]{res/codeExample/segnaposto.html} %c'e' gia' da un'altra parte della relazione. Meglio un richiamo?

Prima di visualizzare l'HTML \`e necessario applicare il parsing del Perl Template Toolkit in moda da sostituire i simboli di segnaposto con il valore richiesto sia esso solo testo o struttura HTML presi da altri file.
La Perl Template Toolkit dispone una serie di utilities a livello di sintassi dette ``\textit{Direttive}'', per offrire una serie di costrutti (es. ciclo for, while, ecc.) in grado di renderlo equiparabile alle trasformate XSLT: durante la stesura del progetto si \`e deciso di non implementare questa soluzione in quanto si si \`e temuto di mescolare il comportamento con la struttura.


%TODO: da rileggere e controllare
\subsubsection{Organizzazione}
Un'aspetto importante che si \`e tenuto conto nel progetto \`e stata il fattore di estendibilit\`a e di riuso. Ci siamo ispirati al paradigma di programmazzione orientato agli oggetti per poter modellare la nostra 'gerarchia' di elementi web ed usato il pattern architetturale MVC in quanto si sposa magnificamente con le componenti di un sito web.

Ogni elemento definito avr\`a tre componenti: la view HTML ( Model ), regole CSS sui tag definiti ( View ) ed il package Perl contenente le regole di costruzione e funzionalit\`a richieste ( Controller ).
I package sono stati introdotti in sostituzione alle classi visto che l'unico momento di un oggetto web \`e l'istanziazzione per la visualizzazione, infatti in ogni package \`e presente il metodo \textit{get} che funge da costruttore.

La OOP viene applicata nella definizione della gerarchia citata. Ogni package si pu\`o dire che derivi dal package \textit{Base} dove sono archiviati tutti gli script base per il funzionamento del sito web e metodi di uso comune. Di fatto in base troviamo:
\begin{itemize}
\item Script di parsing della view HTML usando Perl Template Toolkit;
\item Script per la lettura dei file xml;
\item Script per la gestione delle sessioni;
\item Script per il concatenamento tra i vari oggetti;
\end{itemize}

Da Base si deriva in \textit{Object} che sfuttando le funzionalit\`a della classe padre si costruiscono tutti gli elementi presenti nel sito web. Infine c\`e \textit{Page} che mette in relazione gli oggetti tra di loro per formare le pagine da visualizzare. \`E qui che si dimostra la potenza dei segnaposti in quando \`e possibile definire la pagina come l'insieme di segnaposti e con Perl caricare ogni modulo senza legare comportamente con struttura.
Durante lo sviluppo \`e capitato di modificare parti di HTML o molto pi\`u spesso quelle di Perl ma in entrambi i casi le operazioni non erano dispendiose in quanto un cambio nella logica non implicava un cambio nel modello, e viceversa.

\subsubsection{Visualizzazione e navigazione}




L'html \`e stato scritto in maniera tale da permettere una massima modularizzazione. \textbf{r.cgi} \`e lo script principale del sito, che si occupa di servire le pagine corrette.
Le pagine web che vengono servite sono ``costruite" dal perl secondo uno specifico metodo. \textit{r.cgi} chiama il modulo per la costruzione della pagina, che ricorsivamente chiama il modulo per la costruzione delle sottoparti, restituendo poi il tutto all'utente.

Durante il parsing, viene riconosciuto il segnaposto e viene aggiunto il modulo html corrente.
\subsubsection{Interazione con la base XML}
Perl non si occupa solamente della generazione dell'html, ma anche del prelievo dei dati dalla base scritta in XML.
%TODO
\subsubsection{Gesione delle sessioni}
Le sessioni (salvate nel server) vengono gestite tramite l'utilizzo di cookies (che riportano l'id della sessione corrispondente): permettono agli utenti registrati di eseguire il login e di accedere ad altre funzionalit\`a.
%TODO
